<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>HalfBug</title>
    <meta name="description" content="网站的描述，它将会以 &lt;meta&gt; 标签渲染到当前页面的 HTML 中">
    <meta name="generator" content="VuePress 1.3.0">
    <link rel="icon" href="/myblog/imgs/jdlogo.gif">
    
    <link rel="preload" href="/myblog/assets/css/0.styles.902742fa.css" as="style"><link rel="preload" href="/myblog/assets/js/app.7cbfc1fb.js" as="script"><link rel="preload" href="/myblog/assets/js/3.6312257c.js" as="script"><link rel="preload" href="/myblog/assets/js/2.fb23f600.js" as="script"><link rel="preload" href="/myblog/assets/js/5.e33d7b33.js" as="script"><link rel="preload" href="/myblog/assets/js/19.2622c9a6.js" as="script"><link rel="prefetch" href="/myblog/assets/js/10.f8e5dffc.js"><link rel="prefetch" href="/myblog/assets/js/11.af7d8c61.js"><link rel="prefetch" href="/myblog/assets/js/12.6cf43d53.js"><link rel="prefetch" href="/myblog/assets/js/13.ad35bc1e.js"><link rel="prefetch" href="/myblog/assets/js/14.5039ba13.js"><link rel="prefetch" href="/myblog/assets/js/15.9d17a914.js"><link rel="prefetch" href="/myblog/assets/js/16.27f727a0.js"><link rel="prefetch" href="/myblog/assets/js/17.74d8647f.js"><link rel="prefetch" href="/myblog/assets/js/18.9b785cc6.js"><link rel="prefetch" href="/myblog/assets/js/20.7e7930fe.js"><link rel="prefetch" href="/myblog/assets/js/21.829c7d56.js"><link rel="prefetch" href="/myblog/assets/js/22.b43ab377.js"><link rel="prefetch" href="/myblog/assets/js/23.313b3c74.js"><link rel="prefetch" href="/myblog/assets/js/24.2fcc7c14.js"><link rel="prefetch" href="/myblog/assets/js/4.fbe4f91b.js"><link rel="prefetch" href="/myblog/assets/js/6.a7071b1d.js"><link rel="prefetch" href="/myblog/assets/js/7.951b50c3.js"><link rel="prefetch" href="/myblog/assets/js/8.2bdd9949.js"><link rel="prefetch" href="/myblog/assets/js/9.aca1aa67.js">
    <link rel="stylesheet" href="/myblog/assets/css/0.styles.902742fa.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/myblog/" class="home-link router-link-active"><!----> <span class="site-name">HalfBug</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/myblog/tec/" class="nav-link router-link-active">
  技术
</a></div><div class="nav-item"><a href="https://jandan.net/top-4h" target="_blank" rel="noopener noreferrer" class="nav-link external">
  摸鱼
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav> <div class="can-hide" style="margin-left:20px;margin-right:20px;"><i class="el-icon-headset"></i> <div role="switch" class="el-switch"><input type="checkbox" name="" true-value="true" class="el-switch__input"><!----><span class="el-switch__core" style="width:40px;"></span><!----></div> <audio loop="loop"><source src="/myblog/assets/media/the truth that you leave.c6e2668d.mp3" type="audio/mpeg"></audio></div></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/myblog/tec/" class="nav-link router-link-active">
  技术
</a></div><div class="nav-item"><a href="https://jandan.net/top-4h" target="_blank" rel="noopener noreferrer" class="nav-link external">
  摸鱼
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>前端技术</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/myblog/tec/【20191021】vscode 的终端 shell 设置.html" class="sidebar-link">vscode 的终端配置</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>练手小项目</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/myblog/tec/04. vue.js+openlayers 实现天气系统可视化.html" class="active sidebar-link">vue+openlayers 实现天气预报可视化</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/myblog/tec/04. vue.js+openlayers 实现天气系统可视化.html#背景" class="sidebar-link">背景</a></li><li class="sidebar-sub-header"><a href="/myblog/tec/04. vue.js+openlayers 实现天气系统可视化.html#实现" class="sidebar-link">实现</a></li></ul></li><li><a href="/myblog/tec/02. 使用 cheerio 插件爬取静态页面.html" class="sidebar-link">cheerio 爬取静态网页</a></li><li><a href="/myblog/tec/01. 使用 puppeteer 插件爬取动态网站.html" class="sidebar-link">puppeteer 爬取动态网站</a></li><li><a href="/myblog/tec/03. 使用 nodejs 对文件进行批量重命名.html" class="sidebar-link">nodejs 批量重命名</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>开发工具</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/myblog/tec/05 Arcgis 10.6 安装教程.html" class="sidebar-link">arcgis 10.6安装破解教程</a></li><li><a href="/myblog/tec/【20191021】vscode 的终端 shell 设置.html" class="sidebar-link">vscode 终端shell配置</a></li><li><a href="/myblog/tec/06 项目部署.html" class="sidebar-link">github 项目部署</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><p></p><div class="table-of-contents"><ul><li><a href="#背景">背景</a></li><li><a href="#实现">实现</a><ul><li><a href="#_1-环境配置">1.环境配置</a><ul><li><a href="#_1-1-vue-cli-搭建项目结构">1.1 vue-cli 搭建项目结构</a></li><li><a href="#_1-2-openlayers-引包">1.2 openlayers 引包</a></li></ul></li><li><a href="#_2-业务逻辑实现">2. 业务逻辑实现</a><ul><li><a href="#_2-1-底图">2.1 底图</a></li><li><a href="#_2-2-获取实时天气信息">2.2 获取实时天气信息</a></li><li><a href="#_2-3-添加天气图标">2.3 添加天气图标</a></li><li><a href="#_2-4-为图标增加-hover-弹窗详细信息">2.4 为图标增加 hover 弹窗详细信息</a></li></ul></li><li><a href="#_3-数据组织">3. 数据组织</a><ul><li><a href="#_3-1-天气接口">3.1 天气接口</a></li><li><a href="#_3-2-城市数据">3.2 城市数据</a></li><li><a href="#_3-3-天气图标数据">3.3 天气图标数据</a></li></ul></li><li><a href="#_4-客户端表现形式">4 客户端表现形式</a><ul><li><a href="#_4-1-地理底图">4.1 地理底图</a></li><li><a href="#_4-2-天气图标展示">4.2 天气图标展示</a></li><li><a href="#_4-3-天气详细信息弹窗示意">4.3 天气详细信息弹窗示意</a></li></ul></li><li><a href="#_5-系统部署">5 系统部署</a><ul><li><a href="#_5-1-vue项目导出">5.1 vue项目导出</a></li><li><a href="#_5-2-系统部署">5.2 系统部署</a></li><li><a href="#_5-3-系统访问">5.3 系统访问</a></li></ul></li></ul></li></ul></div><p></p> <h2 id="背景"><a href="#背景" class="header-anchor">#</a> 背景</h2> <p>课程作业需要，做一定的地理信息服务技术。不想再用之前项目中的 arcgis api for javascript，决定尝试点新轮子，尝试使用 vuejs+openlayers 来实现。</p> <h2 id="实现"><a href="#实现" class="header-anchor">#</a> 实现</h2> <h3 id="_1-环境配置"><a href="#_1-环境配置" class="header-anchor">#</a> 1.环境配置</h3> <h4 id="_1-1-vue-cli-搭建项目结构"><a href="#_1-1-vue-cli-搭建项目结构" class="header-anchor">#</a> 1.1 vue-cli 搭建项目结构</h4> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 1. 全局安装 vue-cli</span>
npm i vue<span class="token operator">-</span>cli <span class="token operator">-</span>g
<span class="token comment">// 2. 项目搭建</span>
vue init webpack project_name

<span class="token comment">// 3. 进入项目</span>
cd project_name

<span class="token comment">// 4. 运行项目</span>
npm run dev
</code></pre></div><h4 id="_1-2-openlayers-引包"><a href="#_1-2-openlayers-引包" class="header-anchor">#</a> 1.2 openlayers 引包</h4> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 1. 使用包管理工具下载 openlayers 模块</span>
npm i ol
<span class="token comment">// 2. 引包</span>
<span class="token comment">// 这个版本的 ol 不能全局引入，而是需要什么模块就引入什么模块</span>
<span class="token keyword">import</span> <span class="token string">&quot;ol/ol.css&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> Map<span class="token punctuation">,</span> View <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;ol&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token constant">OSM</span> <span class="token keyword">from</span> <span class="token string">&quot;ol/source/OSM&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> mapconfig <span class="token keyword">from</span> <span class="token string">&quot;../config/mapconfig&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> OlFeature <span class="token keyword">from</span> <span class="token string">&quot;ol/Feature&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> OlGeomPoint <span class="token keyword">from</span> <span class="token string">&quot;ol/geom/Point&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> OlLayerVector <span class="token keyword">from</span> <span class="token string">&quot;ol/layer/Vector&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> OlSourceVector <span class="token keyword">from</span> <span class="token string">&quot;ol/source/Vector&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> OlStyleStyle <span class="token keyword">from</span> <span class="token string">&quot;ol/style/Style&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> OlStyleIcon <span class="token keyword">from</span> <span class="token string">&quot;ol/style/Icon&quot;</span><span class="token punctuation">;</span>
<span class="token comment">// 用来添加相关文字描述的</span>
<span class="token keyword">import</span> Text <span class="token keyword">from</span> <span class="token string">&quot;ol/style/Text&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> Fill <span class="token keyword">from</span> <span class="token string">&quot;ol/style/Fill&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> OlOverlay <span class="token keyword">from</span> <span class="token string">&quot;ol/Overlay&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> OlInteractionSelect <span class="token keyword">from</span> <span class="token string">&quot;ol/interaction/Select&quot;</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="_2-业务逻辑实现"><a href="#_2-业务逻辑实现" class="header-anchor">#</a> 2. 业务逻辑实现</h3> <h4 id="_2-1-底图"><a href="#_2-1-底图" class="header-anchor">#</a> 2.1 底图</h4> <div class="language-js extra-class"><pre class="language-js"><code>    <span class="token function">initMap</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 获取底图盒子</span>
      <span class="token keyword">var</span> mapcontainer <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>$refs<span class="token punctuation">.</span>rootmap<span class="token punctuation">;</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>map <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Map</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        target<span class="token operator">:</span> mapcontainer<span class="token punctuation">,</span>
        layers<span class="token operator">:</span> mapconfig<span class="token punctuation">.</span><span class="token function">streetmap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        view<span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">View</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
          projection<span class="token operator">:</span> <span class="token string">&quot;EPSG:4326&quot;</span><span class="token punctuation">,</span>
          center<span class="token operator">:</span> <span class="token punctuation">[</span>mapconfig<span class="token punctuation">.</span>x<span class="token punctuation">,</span> mapconfig<span class="token punctuation">.</span>y<span class="token punctuation">]</span><span class="token punctuation">,</span>
          zoom<span class="token operator">:</span> mapconfig<span class="token punctuation">.</span>zoom
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre></div><h4 id="_2-2-获取实时天气信息"><a href="#_2-2-获取实时天气信息" class="header-anchor">#</a> 2.2 获取实时天气信息</h4> <div class="language-js extra-class"><pre class="language-js"><code>    <span class="token comment">// 根据城市名称获取真实天气，并调用添加图标按钮</span>
    <span class="token function">getRealWeather</span><span class="token punctuation">(</span><span class="token parameter">city</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">let</span> obj <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span> <span class="token comment">// 拼接天气对象</span>
      obj<span class="token punctuation">.</span>xy <span class="token operator">=</span> city<span class="token punctuation">.</span>xy<span class="token punctuation">;</span>
      obj<span class="token punctuation">.</span>name <span class="token operator">=</span> city<span class="token punctuation">.</span>name<span class="token punctuation">;</span>
      <span class="token comment">// 全局引用的 axios 模块，用来发送网络请求</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>$axios
        <span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">/weather/query?appkey=6d3c803ad2d8bc0f&amp;city=</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>city<span class="token punctuation">.</span>name<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">res</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
          console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token keyword">let</span> data <span class="token operator">=</span> res<span class="token punctuation">.</span>data<span class="token punctuation">;</span>
          <span class="token keyword">if</span> <span class="token punctuation">(</span>data<span class="token punctuation">.</span>status <span class="token operator">===</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// 根据结果，选择天气图标</span>
            obj<span class="token punctuation">.</span>src <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">../../static/weathers_blue/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>data<span class="token punctuation">.</span>result<span class="token punctuation">.</span>img<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">.png</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
            obj<span class="token punctuation">.</span>msg <span class="token operator">=</span> data<span class="token punctuation">.</span>result<span class="token punctuation">.</span>index<span class="token punctuation">;</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">addPic</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 调用添加图标函数</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre></div><h4 id="_2-3-添加天气图标"><a href="#_2-3-添加天气图标" class="header-anchor">#</a> 2.3 添加天气图标</h4> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 向地图添加图标</span>
    <span class="token function">addPic</span><span class="token punctuation">(</span><span class="token parameter">obj</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">let</span> startMarker <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">OlFeature</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        type<span class="token operator">:</span> <span class="token string">&quot;icon&quot;</span><span class="token punctuation">,</span>
        geometry<span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">OlGeomPoint</span><span class="token punctuation">(</span>obj<span class="token punctuation">.</span>xy<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token comment">// 图片定位坐标</span>
        callbackParams<span class="token operator">:</span> obj <span class="token comment">// 将天气信息储存起来，用作后面的回调</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">let</span> vectorLayer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">OlLayerVector</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        source<span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">OlSourceVector</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
          features<span class="token operator">:</span> <span class="token punctuation">[</span>startMarker<span class="token punctuation">]</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        style<span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">OlStyleStyle</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
          image<span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">OlStyleIcon</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
            src<span class="token operator">:</span> obj<span class="token punctuation">.</span>src<span class="token punctuation">,</span><span class="token comment">// 图片链接</span>
            scale<span class="token operator">:</span> <span class="token number">0.5</span> <span class="token comment">// 图片缩放比例</span>
          <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>map<span class="token punctuation">.</span><span class="token function">addLayer</span><span class="token punctuation">(</span>vectorLayer<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre></div><h4 id="_2-4-为图标增加-hover-弹窗详细信息"><a href="#_2-4-为图标增加-hover-弹窗详细信息" class="header-anchor">#</a> 2.4 为图标增加 hover 弹窗详细信息</h4> <div class="language-js extra-class"><pre class="language-js"><code>    <span class="token comment">// 弹窗注册</span>
    <span class="token keyword">var</span> element <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&quot;popup&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">var</span> popup <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">OlOverlay</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      element<span class="token operator">:</span> element<span class="token punctuation">,</span>
      positioning<span class="token operator">:</span> <span class="token string">&quot;bottom-center&quot;</span><span class="token punctuation">,</span>
      stopEvent<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
      offset<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">10</span><span class="token punctuation">]</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>map<span class="token punctuation">.</span><span class="token function">addOverlay</span><span class="token punctuation">(</span>popup<span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token comment">// 增加 hover 事件</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>map<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">&quot;pointermove&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">evt</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">var</span> feature <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>map<span class="token punctuation">.</span><span class="token function">forEachFeatureAtPixel</span><span class="token punctuation">(</span>evt<span class="token punctuation">.</span>pixel<span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">feature</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> feature<span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token comment">// 判断是否移动到图标上</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>feature<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">var</span> coordinates <span class="token operator">=</span> feature<span class="token punctuation">.</span><span class="token function">getGeometry</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getCoordinates</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        popup<span class="token punctuation">.</span><span class="token function">setPosition</span><span class="token punctuation">(</span>coordinates<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 获取天气信息的回调</span>
        <span class="token keyword">let</span> msg <span class="token operator">=</span> feature<span class="token punctuation">.</span>values_<span class="token punctuation">.</span>data<span class="token punctuation">.</span>callbackParams
        <span class="token comment">// 添加展示内容</span>
        <span class="token function">$</span><span class="token punctuation">(</span>element<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">popover</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
          placement<span class="token operator">:</span> <span class="token string">&quot;top&quot;</span><span class="token punctuation">,</span>
          html<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
          content<span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">&lt;h5&gt;</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>msg<span class="token punctuation">.</span>name<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&lt;/h5&gt;
                     &lt;p&gt;&lt;b&gt;</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>msg<span class="token punctuation">.</span>msg<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>iname<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&lt;/b&gt;：</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>msg<span class="token punctuation">.</span>msg<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>detail<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&lt;/p&gt;
                    &lt;p&gt;&lt;b&gt;</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>msg<span class="token punctuation">.</span>msg<span class="token punctuation">[</span><span class="token number">6</span><span class="token punctuation">]</span><span class="token punctuation">.</span>iname<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&lt;/b&gt;：</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>msg<span class="token punctuation">.</span>msg<span class="token punctuation">[</span><span class="token number">6</span><span class="token punctuation">]</span><span class="token punctuation">.</span>detail<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&lt;/p&gt;
                    </span><span class="token template-punctuation string">`</span></span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">$</span><span class="token punctuation">(</span>element<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">popover</span><span class="token punctuation">(</span><span class="token string">&quot;show&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token function">$</span><span class="token punctuation">(</span>element<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">popover</span><span class="token punctuation">(</span><span class="token string">&quot;dispose&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="_3-数据组织"><a href="#_3-数据组织" class="header-anchor">#</a> 3. 数据组织</h3> <h4 id="_3-1-天气接口"><a href="#_3-1-天气接口" class="header-anchor">#</a> 3.1 天气接口</h4> <p>实时天气数据来源于某网站的 api 接口。
<img src="30A4D31AF90A49D1A2436BEC23154DCE" alt="image"></p> <p>该接口可直接通过城市名称进行查询。
<img src="BCD393A345A5496A8FE6601CF1E9058B" alt="image"></p> <h4 id="_3-2-城市数据"><a href="#_3-2-城市数据" class="header-anchor">#</a> 3.2 城市数据</h4> <p>天气查询需要城市名称数据，图标展示需要城市的坐标数据。</p> <p>所需数据量不大，因此并未引入数据库系统，直接通过变量存储在系统内。</p> <div class="language-js extra-class"><pre class="language-js"><code>
    <span class="token comment">// 由于 api 请求次数的限制，系统中只展示了部分城市</span>
    cities<span class="token operator">:</span> <span class="token punctuation">{</span>
        海门<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token number">121.15</span><span class="token punctuation">,</span> <span class="token number">31.89</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        鄂尔多斯<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token number">109.781327</span><span class="token punctuation">,</span> <span class="token number">39.608266</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        招远<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token number">120.38</span><span class="token punctuation">,</span> <span class="token number">37.35</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        舟山<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token number">122.207216</span><span class="token punctuation">,</span> <span class="token number">29.985295</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        齐齐哈尔<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token number">123.97</span><span class="token punctuation">,</span> <span class="token number">47.33</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        盐城<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token number">120.13</span><span class="token punctuation">,</span> <span class="token number">33.38</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        赤峰<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token number">118.87</span><span class="token punctuation">,</span> <span class="token number">42.28</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        青岛<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token number">120.33</span><span class="token punctuation">,</span> <span class="token number">36.07</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        乳山<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token number">121.52</span><span class="token punctuation">,</span> <span class="token number">36.89</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        金昌<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token number">102.188043</span><span class="token punctuation">,</span> <span class="token number">38.520089</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        泉州<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token number">118.58</span><span class="token punctuation">,</span> <span class="token number">24.93</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        莱西<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token number">120.53</span><span class="token punctuation">,</span> <span class="token number">36.86</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        日照<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token number">119.46</span><span class="token punctuation">,</span> <span class="token number">35.42</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        胶南<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token number">119.97</span><span class="token punctuation">,</span> <span class="token number">35.88</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token comment">// ......</span>
    <span class="token punctuation">}</span>
    
    
</code></pre></div><h4 id="_3-3-天气图标数据"><a href="#_3-3-天气图标数据" class="header-anchor">#</a> 3.3 天气图标数据</h4> <p>api 接口提供了对应天气情况的图标 icon，将图标作为静态资源存储起来，通过相对路径直接调用。</p> <p><img src="E917546DFBC74FDEBAD171517655471D" alt="image"></p> <h3 id="_4-客户端表现形式"><a href="#_4-客户端表现形式" class="header-anchor">#</a> 4 客户端表现形式</h3> <h4 id="_4-1-地理底图"><a href="#_4-1-地理底图" class="header-anchor">#</a> 4.1 地理底图</h4> <p><img src="24D7932ECFEE42B4AFBF07534E2C4862" alt="image"></p> <h4 id="_4-2-天气图标展示"><a href="#_4-2-天气图标展示" class="header-anchor">#</a> 4.2 天气图标展示</h4> <p><img src="9D00084B845A403D9DC7BFBE8A80003D" alt="image"></p> <h4 id="_4-3-天气详细信息弹窗示意"><a href="#_4-3-天气详细信息弹窗示意" class="header-anchor">#</a> 4.3 天气详细信息弹窗示意</h4> <p><img src="A7891ABD59FB474A9AD1E28F14B68F97" alt="image"></p> <h3 id="_5-系统部署"><a href="#_5-系统部署" class="header-anchor">#</a> 5 系统部署</h3> <h4 id="_5-1-vue项目导出"><a href="#_5-1-vue项目导出" class="header-anchor">#</a> 5.1 vue项目导出</h4> <div class="language-js extra-class"><pre class="language-js"><code>npm run build <span class="token comment">// 生成 dist 文件夹</span>
</code></pre></div><h4 id="_5-2-系统部署"><a href="#_5-2-系统部署" class="header-anchor">#</a> 5.2 系统部署</h4> <p>之前一直使用 tomcat 部署，但是这个系统中，api 的请求接口涉及到跨域问题。经过资料检索，决定使用具有反向代理功能的 nginx 进行部署。</p> <p><strong>反向代理的原理</strong></p> <p>正向代理是一个位于客户端和目标服务器之间的代理服务器(中间服务器)。为了从原始服务器取得内容，客户端向代理服务器发送一个请求，并且指定目标服务器，之后代理向目标服务器转交并且将获得的内容返回给客户端。正向代理的情况下客户端必须要进行一些特别的设置才能使用。</p> <p>反向代理正好相反。对于客户端来说，反向代理就好像目标服务器。并且客户端不需要进行任何设置。客户端向反向代理发送请求，接着反向代理判断请求走向何处，并将请求转交给客户端，使得这些内容就好似他自己一样，一次客户端并不会感知到反向代理后面的服务，也因此不需要客户端做任何设置，只需要把反向代理服务器当成真正的服务器就好了。</p> <p><strong>nginx配置</strong></p> <div class="language- extra-class"><pre class="language-text"><code>// nginx/config/nginx.conf
http:{
    server:{
        location /weather {
		    proxy_pass https://api.jisuapi.com; 
	    }
    }
}
</code></pre></div><h4 id="_5-3-系统访问"><a href="#_5-3-系统访问" class="header-anchor">#</a> 5.3 系统访问</h4> <p>http://10.5.201.135:9999/</p></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/myblog/tec/【20191021】vscode 的终端 shell 设置.html" class="prev">
        vscode 的终端配置
      </a></span> <span class="next"><a href="/myblog/tec/02. 使用 cheerio 插件爬取静态页面.html">
        cheerio 爬取静态网页
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/myblog/assets/js/app.7cbfc1fb.js" defer></script><script src="/myblog/assets/js/3.6312257c.js" defer></script><script src="/myblog/assets/js/2.fb23f600.js" defer></script><script src="/myblog/assets/js/5.e33d7b33.js" defer></script><script src="/myblog/assets/js/19.2622c9a6.js" defer></script>
  </body>
</html>
